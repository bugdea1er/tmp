---
name: Lint
"on": pull_request

permissions:
  contents: read

jobs:
  yamllint:
    runs-on: ubuntu-24.04
    steps:
      - name: Checkout repository
        uses: actions/checkout@v4
      - name: Run yamllint
        run: yamllint .github/workflows/ -f github

  clang-format:
    runs-on: ubuntu-24.04
    steps:
      - name: Checkout repository
        uses: actions/checkout@v4
      - name: Run clang-format
        run: |
          clang-format -i $(find include/tmp -type f; find . -name '*.cpp')
          git diff --color --exit-code

  cmake-format:
    runs-on: macos-latest
    steps:
      - name: Checkout repository
        uses: actions/checkout@v4

      - name: Install cmake-format
        run: pip install cmake-format

      - name: Run cmake-format
        run: |
          (find cmake -name '*.cmake.in'; find cmake -name '*.cmake'; \
          find . tests -maxdepth 1 -name 'CMakeLists.txt') \
            | xargs cmake-format -i
          git diff --color --exit-code
