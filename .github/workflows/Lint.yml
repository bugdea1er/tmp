name: Lint

on: pull_request

permissions:
  contents: read

jobs:
  format:
    runs-on: ubuntu-24.04
    steps:
      - name: Checkout repository
        uses: actions/checkout@v3

      - name: Install cmake-format
        run: pip install cmake-format

      - name: Run clang-format
        run: |
          (find include/tmp -type f; find src tests -name '*.cpp') \
            | xargs clang-format-18 -i -style=file --verbose
          git diff --color --exit-code

      - name: Run cmake-format
        run: |
          (find cmake -name '*.cmake.in'; find cmake -name '*.cmake'; find . tests -maxdepth 1 -name 'CMakeLists.txt') \
            | xargs cmake-format -i
          git diff --color --exit-code
  tidy:
    runs-on: ubuntu-24.04
    steps:
      - name: Checkout repository
        uses: actions/checkout@v3

      - name: Run clang-tidy
        run:  clang-tidy-18 --quiet src/tmp.cpp -- -std=c++17 -Iinclude/
